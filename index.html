<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Asteroid Impact Simulator</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; color: white; font-family: sans-serif; }
    #ui {
      position: absolute; top: 10px; left: 10px; z-index: 10;
      background: rgba(0,0,0,0.6); padding: 10px; border-radius: 8px;
    }
    label, select, button { margin: 5px; }
  </style>
</head>
<body>
  <div id="ui">
    <label>Asteroid Size:</label>
    <select id="size">
      <option value="0.1">Small</option>
      <option value="0.3">Medium</option>
      <option value="0.6">Large</option>
    </select><br>

    <label>Speed:</label>
    <select id="speed">
      <option value="0.02">Slow</option>
      <option value="0.05">Medium</option>
      <option value="0.1">Fast</option>
    </select><br>

    <button id="launch">Launch Asteroid</button>
    <button id="reset">Reset</button>
  </div>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.152.2/build/three.module.js";
    import { OrbitControls } from "https://unpkg.com/three@0.152.2/examples/jsm/controls/OrbitControls.js";

    // --- Scene Setup ---
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000000);

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 2, 6);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);

    // --- Earth ---
    const earthGeometry = new THREE.SphereGeometry(1, 64, 64);
    const earthMaterial = new THREE.MeshStandardMaterial({ color: 0x2266ff });
    const earth = new THREE.Mesh(earthGeometry, earthMaterial);
    scene.add(earth);

    // --- Lights ---
    const light = new THREE.PointLight(0xffffff, 2);
    light.position.set(5, 5, 5);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x404040));

    // --- Asteroid ---
    let asteroid, asteroidSpeed = 0.02, asteroidActive = false;

    function createAsteroid(size) {
      const asteroidGeometry = new THREE.SphereGeometry(size, 32, 32);
      const asteroidMaterial = new THREE.MeshStandardMaterial({ color: 0x888888 });
      asteroid = new THREE.Mesh(asteroidGeometry, asteroidMaterial);
      asteroid.position.set(-6, 0, 0);
      scene.add(asteroid);
    }

    // --- Explosion Effect ---
    const particles = [];
    function createExplosion(position) {
      const particleGeometry = new THREE.SphereGeometry(0.05, 8, 8);
      const particleMaterial = new THREE.MeshBasicMaterial({ color: 0xffaa00 });
      for (let i = 0; i < 50; i++) {
        const p = new THREE.Mesh(particleGeometry, particleMaterial);
        p.position.copy(position);
        p.velocity = new THREE.Vector3(
          (Math.random() - 0.5) * 0.2,
          (Math.random() - 0.5) * 0.2,
          (Math.random() - 0.5) * 0.2
        );
        scene.add(p);
        particles.push(p);
      }
    }

    // --- Animate ---
    function animate() {
      requestAnimationFrame(animate);

      if (asteroidActive && asteroid) {
        asteroid.position.x += asteroidSpeed;

        // Check collision with Earth
        if (asteroid.position.distanceTo(earth.position) < 1.1) {
          asteroidActive = false;
          scene.remove(asteroid);
          createExplosion(earth.position.clone());
          earth.material.color.set(0xff4444); // Earth damaged
        }
      }

      // Update particles
      for (let p of particles) {
        p.position.add(p.velocity);
        p.material.opacity -= 0.01;
      }

      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    // --- UI Events ---
    document.getElementById("launch").onclick = () => {
      if (asteroid) scene.remove(asteroid);
      earth.material.color.set(0x2266ff); // reset Earth color
      particles.forEach(p => scene.remove(p));
      particles.length = 0;

      const size = parseFloat(document.getElementById("size").value);
      asteroidSpeed = parseFloat(document.getElementById("speed").value);
      createAsteroid(size);
      asteroidActive = true;
    };

    document.getElementById("reset").onclick = () => {
      if (asteroid) scene.remove(asteroid);
      particles.forEach(p => scene.remove(p));
      particles.length = 0;
      earth.material.color.set(0x2266ff);
      asteroidActive = false;
    };

    // Resize
    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>